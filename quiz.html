<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Quiz</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { width: 100vw; height: 100vh; font-family: sans-serif; }
    body {
      display: flex; align-items: center; justify-content: center;
      background: #4b3481; color: #fff;
    }
    .container {
      background: #36265a; padding: 20px;
      border-radius: 12px; width: 90vw; max-width: 600px;
      display: flex; flex-direction: column;
    }
    h1 {
      background: #f5d300; color: #000;
      padding: 15px; text-align: center;
      border-radius: 8px; margin-bottom: 20px;
      font-size: 1.5em;
    }
    #perguntaTexto { font-size: 1.3em; margin-bottom: 20px; }
    .options {
      list-style: none; flex: 1; overflow-y: auto; padding: 0;
    }
    .options li {
      background: rgba(245,211,0,0.1);
      margin: 8px 0; padding: 12px;
      border: 2px solid #f5d300; border-radius: 8px;
      cursor: pointer; transition: background .2s, border .2s;
    }
    .options li.correct {
      border-color: #0f0; background: rgba(0,255,0,0.1);
    }
    .options li.wrong {
      border-color: #f00; background: rgba(255,0,0,0.1);
    }
    .btn {
      padding: 12px; font-size: 1em;
      border: none; border-radius: 8px;
      background: #f5d300; color: #000;
      cursor: pointer; margin-top: 15px;
    }
    /* overlay de confirmação */
    .overlay {
      position: absolute; top:0; left:0; right:0; bottom:0;
      background: rgba(0,0,0,0.8);
      display: none; flex-direction: column;
      align-items: center; justify-content: center;
      border-radius: 12px; text-align: center;
    }
    .overlay.active { display: flex; }
    .overlay p { font-size: 1.2em; margin-bottom: 20px; }
    .overlay .btn { width: auto; min-width: 100px; margin: 0 10px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>QUIZ</h1>
    <div id="perguntaTexto"></div>
    <ul id="optionsList" class="options"></ul>
    <button id="btnNext" class="btn" style="display:none;">Próxima Pergunta</button>
    <button id="btnRestart" class="btn" style="display:none;">Reiniciar Quiz</button>

    <!-- Overlay de confirmação -->
    <div id="confirmOverlay" class="overlay">
      <p>Tem certeza?</p>
      <div>
        <button id="btnYes" class="btn">Sim</button>
        <button id="btnNo" class="btn">Não</button>
      </div>
    </div>
  </div>

  <script>
    const perguntas = JSON.parse(localStorage.getItem('quizQuestions') || '[]');
    if (!perguntas.length) {
      alert('Nenhuma pergunta cadastrada.');
      history.back();
    }

    let ordem, indexAtual;
    let escolhaLi, escolhaLetra, certaLetra;

    const perguntaTexto = document.getElementById('perguntaTexto');
    const optionsList = document.getElementById('optionsList');
    const btnNext = document.getElementById('btnNext');
    const btnRestart = document.getElementById('btnRestart');
    const confirmOverlay = document.getElementById('confirmOverlay');
    const btnYes = document.getElementById('btnYes');
    const btnNo = document.getElementById('btnNo');

    window.onload = () => {
      ordem = perguntas.map((_, i) => i).sort(() => Math.random() - 0.5);
      indexAtual = 0;
      mostraPergunta();
    };

    function mostraPergunta() {
      const q = perguntas[ordem[indexAtual]];
      perguntaTexto.textContent = q.p;
      certaLetra = q.correta;

      const letras = ['A', 'B', 'C', 'D'].sort(() => Math.random() - 0.5);
      optionsList.innerHTML = '';
      letras.forEach(letra => {
        const li = document.createElement('li');
        li.textContent = `${letra}: ${q[letra]}`;
        li.dataset.letra = letra;
        li.addEventListener('click', onOptionClick);
        optionsList.appendChild(li);
      });

      btnNext.style.display = 'none';
      btnRestart.style.display = 'none';
    }

    function onOptionClick(evt) {
      escolhaLi = evt.currentTarget;
      escolhaLetra = escolhaLi.dataset.letra;
      document.querySelectorAll('#optionsList li')
        .forEach(li => li.removeEventListener('click', onOptionClick));
      confirmOverlay.classList.add('active');
    }

    btnNo.addEventListener('click', () => {
      confirmOverlay.classList.remove('active');
      document.querySelectorAll('#optionsList li')
        .forEach(li => li.addEventListener('click', onOptionClick));
    });

    btnYes.addEventListener('click', () => {
      confirmOverlay.classList.remove('active');

      const corretaLi = document.querySelector(`#optionsList li[data-letra="${certaLetra}"]`);
      if (corretaLi) corretaLi.classList.add('correct');

      if (escolhaLetra !== certaLetra) {
        escolhaLi.classList.add('wrong');
      }

      btnNext.style.display = 'block';
    });

    btnNext.addEventListener('click', () => {
      indexAtual++;
      if (indexAtual < ordem.length) {
        mostraPergunta();
      } else {
        perguntaTexto.textContent = 'Quiz concluído!';
        optionsList.innerHTML = '';
        btnNext.style.display = 'none';
        btnRestart.style.display = 'block';
      }
    });

    btnRestart.addEventListener('click', () => {
      ordem = perguntas.map((_, i) => i).sort(() => Math.random() - 0.5);
      indexAtual = 0;
      mostraPergunta();
    });
  </script>
</body>
</html>
